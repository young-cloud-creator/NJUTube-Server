# NJU TUBE - æœåŠ¡ç«¯

## é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨Goè¯­è¨€ï¼ŒåŸºäº`Gin`æ¡†æ¶å’Œ`GORM`æ¡†æ¶å¼€å‘çš„è§†é¢‘å¹³å°æœåŠ¡ç«¯ï¼Œå®ƒå®ç°äº†ä¸‹é¢çš„å‡ ä¸ªAPIï¼ŒåŒ…æ‹¬è§†é¢‘Feedæµã€è§†é¢‘æŠ•ç¨¿ã€ç”¨æˆ·ç™»é™†æ³¨å†Œã€ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢ã€ç‚¹èµå’Œè¯„è®ºåŠŸèƒ½ï¼š

- `/tube/feed/` è§†é¢‘æµæ¥å£
- `/tube/user/register/` ç”¨æˆ·æ³¨å†Œæ¥å£
- `/tube/user/login/` ç”¨æˆ·ç™»å½•æ¥å£
- `/tube/user/` ç”¨æˆ·ä¿¡æ¯æ¥å£
- `/tube/publish/action/` è§†é¢‘æŠ•ç¨¿æ¥å£
- `/tube/publish/list/` å‘å¸ƒåˆ—è¡¨æ¥å£
- `/tube/favorite/action/` èµæ“ä½œæ¥å£
- `/tube/favorite/list/` ç‚¹èµåˆ—è¡¨æ¥å£
- `/tube/comment/action/` è¯„è®ºæ“ä½œæ¥å£
- `/tube/comment/list/` è¯„è®ºåˆ—è¡¨æ¥å£

## æ³¨æ„äº‹é¡¹

- é¡¹ç›®ä¾èµ–äº`ffmpeg`ï¼Œè¯·è‡ªè¡Œå®‰è£…
  - æ³¨ï¼šä¹Ÿå¯æ”¹ç”¨`OpenCV 4.7.0`ï¼Œé¡»åœ¨`service/publish.go/publishAction`ä¸­å–æ¶ˆæ³¨é‡Šç›¸åº”å‡½æ•°ï¼Œå®‰è£…æ–¹æ³•å‚è€ƒ[gocv.io/getting-started](https://gocv.io/getting-started/)
- `repository/db_setup.go`æ–‡ä»¶çš„`InitDB`å‡½æ•°ä¸­çš„`dsn`å®šä¹‰äº†MySQLæ•°æ®åº“åœ°å€ï¼Œè¿è¡Œæ—¶è¯·è‡ªè¡Œä¿®æ”¹
  - æ•°æ®åº“ä¸­éœ€è¦å­˜åœ¨åä¸º`tube`çš„`database`ï¼Œå…¶ä¸­çš„è¡¨ç»“æ„è¯¦è§`æ•°æ®è¡¨ç»“æ„`éƒ¨åˆ†
- `service/publish.go`æ–‡ä»¶å®šä¹‰äº†è§†é¢‘å’Œå°é¢æ–‡ä»¶å­˜æ”¾çš„å­ç›®å½•ï¼Œå¦‚æœ‰éœ€è¦ï¼Œå¯è‡ªè¡Œä¿®æ”¹`PublicDir`ã€`VideoDir`å’Œ`CoverDir`å˜é‡
- æ•°æ®åº“è¡¨ç»“æ„å·²å¯¼å‡ºåˆ°é¡¹ç›®ç›®å½•ä¸‹çš„`tube.sql`æ–‡ä»¶ï¼Œå¦‚æœ‰éœ€è¦è¯·è‡ªè¡Œå¯¼å…¥
- ä½¿ç”¨`go build`æ„å»ºé¡¹ç›®

Have a Nice Day! ğŸ¥³

## ä»£ç ç»“æ„ä»‹ç»

ä»£ç çš„ç»„ç»‡ç»“æ„å¦‚ä¸‹ï¼ŒåŸºæœ¬æŒ‰ç…§[github.com/bxcodec/go-clean-arch](https://github.com/bxcodec/go-clean-arch)ä¸­æè¿°çš„æ¶æ„è¿›è¡Œè®¾è®¡

![image](https://user-images.githubusercontent.com/84324349/217787742-6d8274a4-a8af-44d9-aad8-8ab968323247.png)

```
.
â”‚
â”œâ”€â”€ structs        // é¡¹ç›®å¸¸ç”¨çš„ç»“æ„ä½“ 
â”‚   â””â”€â”€ common.go     //  ä¸€äº›åŸºæœ¬çš„ç»“æ„ä½“ å¦‚Userã€Videoã€Commentç­‰ 
â”‚
â”œâ”€â”€ controller     // ç›´æ¥ä¸APIä½¿ç”¨è€…äº¤äº’ è´Ÿè´£ç»„ç»‡å’Œå‘é€Responseã€éªŒè¯tokenç­‰ 
â”‚   â”œâ”€â”€ comment.go    // è¯„è®ºç›¸å…³API 
â”‚   â”œâ”€â”€ favorite.go   // ç‚¹èµç›¸å…³API 
â”‚   â”œâ”€â”€ feed.go       // Feedæµç›¸å…³API 
â”‚   â”œâ”€â”€ publish.go    // å‘å¸ƒç›¸å…³API åŒ…æ‹¬å‘å¸ƒè§†é¢‘ã€å·²å‘å¸ƒè§†é¢‘åˆ—è¡¨ç­‰API 
â”‚   â””â”€â”€ user.go       // ç”¨æˆ·ç›¸å…³API å¦‚æ³¨å†Œã€ç™»é™†ã€ç”¨æˆ·ä¿¡æ¯ç­‰ 
â”‚
â”œâ”€â”€ service        // è¢«controllerä½¿ç”¨ è´Ÿè´£å…·ä½“ä¸šåŠ¡é€»è¾‘å®ç° 
â”‚   â”œâ”€â”€ comment.go    // comment APIç›¸å…³çš„å…·ä½“ä¸šåŠ¡é€»è¾‘ åŒ…æ‹¬è¯„è®ºæƒé™åˆ¤å®šã€è¯„è®ºæ ¼å¼è½¬æ¢ç­‰ 
â”‚   â”œâ”€â”€ favorite.go   // favorite APIç›¸å…³çš„å…·ä½“ä¸šåŠ¡é€»è¾‘ ä¸»è¦è´Ÿè´£ç‚¹èµåˆ—è¡¨çš„æ ¼å¼è½¬æ¢ï¼ˆå­˜å‚¨æ ¼å¼->å“åº”æ ¼å¼ï¼‰ 
â”‚   â”œâ”€â”€ feed.go       // feed APIç›¸å…³çš„å…·ä½“ä¸šåŠ¡é€»è¾‘ åŒ…æ‹¬æ—¶é—´æˆ³è½¬æ¢ã€è§†é¢‘åˆ—è¡¨æ•°æ®å¤„ç†ç­‰ 
â”‚   â”œâ”€â”€ publish.go    // publish APIç›¸å…³çš„å…·ä½“ä¸šåŠ¡é€»è¾‘ åŒ…æ‹¬æŠ•ç¨¿è§†é¢‘å°é¢æˆªå–ã€æŠ•ç¨¿è§†é¢‘åˆ—è¡¨æ•°æ®å¤„ç†ç­‰ 
â”‚   â””â”€â”€ user.go       // user APIç›¸å…³çš„å…·ä½“ä¸šåŠ¡é€»è¾‘ åŒ…æ‹¬å¯†ç åŠ å¯†ã€ç”¨æˆ·åå¯†ç éªŒè¯ç­‰ 
â”‚
â”œâ”€â”€ repository     // è¢«serviceä½¿ç”¨ è´Ÿè´£åº•å±‚æ•°æ®åº“æ“ä½œ 
â”‚   â”œâ”€â”€ comment.go    // commentæ•°æ®è¡¨ç›¸å…³æ“ä½œ 
â”‚   â”œâ”€â”€ common.go     // gorm model ç”¨äºè¡¨ç¤ºæ•°æ®åº“ä¸­çš„å„å¼ è¡¨ 
â”‚   â”œâ”€â”€ db_setup.go   // è´Ÿè´£è¿æ¥åˆ°æ•°æ®åº“ 
â”‚   â”œâ”€â”€ favorite.go   // favoriteæ•°æ®è¡¨ç›¸å…³æ“ä½œ 
â”‚   â”œâ”€â”€ video.go      // è§†é¢‘ä¿¡æ¯å­˜å‚¨ä¸æŸ¥è¯¢ 
â”‚   â””â”€â”€ user.go       // userè¡¨ç›¸å…³æ•°æ®åº“æ“ä½œ 
â”‚
â”œâ”€â”€ security       // å®‰å…¨ç›¸å…³çš„å‡½æ•° ä¾‹å¦‚tokenç”Ÿæˆå’ŒéªŒè¯ 
â”‚   â””â”€â”€ jwt.go        // JSON Web Tokenï¼ˆJWTï¼‰ç”Ÿæˆå’ŒéªŒè¯ 
â”‚
â”œâ”€â”€ main.go        // å…¥å£ è´Ÿè´£è°ƒç”¨ç›¸å…³æ–¹æ³•åˆå§‹åŒ–æ•°æ®åº“ã€åˆå§‹åŒ–è·¯ç”±å’Œè¿è¡ŒæœåŠ¡å™¨ 
â”œâ”€â”€ router.go      // è·¯ç”±åˆå§‹åŒ– è´Ÿè´£è®¾ç½®é™æ€æ–‡ä»¶ç³»ç»Ÿå’ŒAPIè·¯ç”± 
â”‚
â”œâ”€â”€ go.mod
â””â”€â”€ go.sum

```

## æ•°æ®è¡¨ç»“æ„ä»‹ç»

æ•°æ®åº“çš„é…ç½®ä½äº`repository/db_setup.go`ï¼Œè¿è¡Œé¡¹ç›®åï¼Œå°†ä¼šè¿æ¥åˆ°`root:12345678@127.0.0.1:3306`çš„åä¸º`tube`çš„MySQLæ•°æ®åº“ã€‚æ•°æ®åº“æœ‰`user`ã€`video`ã€`favorite`å’Œ`comment`å››å¼ è¡¨ï¼Œåˆ†åˆ«å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€è§†é¢‘ä¿¡æ¯ã€ç‚¹èµä¿¡æ¯å’Œè¯„è®ºä¿¡æ¯ï¼Œä¸‹é¢æ˜¯è¿™å‡ å¼ è¡¨çš„ç»“æ„ã€‚

```
user

+--------+--------------+------+-----+---------+----------------+
| Field  | Type         | Null | Key | Default | Extra          |
+--------+--------------+------+-----+---------+----------------+
| id     | bigint       | NO   | PRI | NULL    | auto_increment |
| name   | varchar(128) | YES  |     | NULL    |                |
| passwd | char(128)    | YES  |     | NULL    |                |
+--------+--------------+------+-----+---------+----------------+

æ³¨ï¼šä¸ºäº†æ•°æ®å®‰å…¨è€ƒè™‘ï¼Œæ­¤å¤„çš„passwdå­—æ®µå­˜å‚¨çš„æ˜¯ç»è¿‡åŠ å¯†çš„å¯†ç ï¼›idä¸ºä¸»é”®ï¼Œè®¾ç½®äº†è‡ªå¢å±æ€§ï¼Œæ— éœ€é¢å¤–è€ƒè™‘IDçš„å”¯ä¸€æ€§
```

```
video

+-------------+---------------+------+-----+---------+----------------+
| Field       | Type          | Null | Key | Default | Extra          |
+-------------+---------------+------+-----+---------+----------------+
| id          | bigint        | NO   | PRI | NULL    | auto_increment |
| author      | bigint        | YES  |     | NULL    |                |
| title       | varchar(1024) | YES  |     | NULL    |                |
| play_url    | varchar(1024) | YES  |     | NULL    |                |
| cover_url   | varchar(1024) | YES  |     | NULL    |                |
| create_time | datetime      | YES  |     | NULL    |                |
+-------------+---------------+------+-----+---------+----------------+

æ³¨ï¼šidä¸ºä¸»é”®ï¼Œè®¾ç½®äº†è‡ªå¢å±æ€§ï¼Œæ— éœ€é¢å¤–è€ƒè™‘IDçš„å”¯ä¸€æ€§
```

```
favorite

+----------+--------+------+-----+---------+-------+
| Field    | Type   | Null | Key | Default | Extra |
+----------+--------+------+-----+---------+-------+
| user_id  | bigint | YES  |     | NULL    |       |
| video_id | bigint | YES  |     | NULL    |       |
+----------+--------+------+-----+---------+-------+
```

```
comment

+-------------+---------------+------+-----+---------+----------------+
| Field       | Type          | Null | Key | Default | Extra          |
+-------------+---------------+------+-----+---------+----------------+
| id          | bigint        | NO   | PRI | NULL    | auto_increment |
| user_id     | bigint        | YES  |     | NULL    |                |
| video_id    | bigint        | YES  |     | NULL    |                |
| content     | varchar(2048) | YES  |     | NULL    |                |
| create_time | datetime      | YES  |     | NULL    |                |
+-------------+---------------+------+-----+---------+----------------+

æ³¨ï¼šidä¸ºä¸»é”®ï¼Œè®¾ç½®äº†è‡ªå¢å±æ€§ï¼Œæ— éœ€é¢å¤–è€ƒè™‘IDçš„å”¯ä¸€æ€§
```
